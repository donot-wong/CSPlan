<?xml version="1.0" standalone="no"?>
<WebApplicationTest>
	<TestDescription name="elmah.axd information disclosure" version="0.1" released="20100114" updated="20140307" protocol="HTTP" mayproxy="true" affects="file" severity="medium" alert="success" type="Validation">
		<WASPDescription BindAlertToFile="0" CrawlerProcessingMode="ParseOnly" TargetFormat="" Target="" ModuleName="" Request="" Response="" FullResponse="" DetailsFormat="" Details="" AuthType="0" AuthName="" AuthPass="" CompInfo="" FolowRedirection="true" DetaliedInformation="" SendCookies="true" AlertTags="configuration,error_handling,information_disclosure" HasPrecondition="false" SendAuth="true" ValidateSession="true" CVE="" CWE="CWE-16" CVSSVer="2.0" CVSSScore="5.0" CVSSDescr="AV:N/AC:L/Au:N/C:P/I:N/A:N" CVSSScoreTemp="5.0" CVSSScoreEnv="5.0"/>
		<Copyright/>
		<Description>ELMAH (Error Logging Modules and Handlers) is an application-wide error logging facility that is completely pluggable. It can be dynamically added to a running ASP.NET web application, or even all ASP.NET web applications on a machine, without any need for re-compilation or re-deployment. If ELMAH is not properly configured, the [bold]elmah.axd[/bold] handler can be accessed without authorization. This page will list all the error messages generated by the web application and may disclose sensitive information to an attacker.</Description>
		<ApplicableTo>
			<Platform>
				<OS>Windows</OS>
				<Arch>i386</Arch></Platform>
			<WebServer>All</WebServer><ApplicationServer>All</ApplicationServer></ApplicableTo>
		<TriggerOn event="scheme_host_port">
			<Match type="regex">.*</Match>
		</TriggerOn>
		<Impact>The error messages may disclose sensitive information. In some cases it's possible to recover the .ASPXAUTH cookie. The ASPXAUTH cookie is used to determine if a user is authenticated. This information can be used to launch further attacks.</Impact>
		<Recommendation>Adjust web.config to deny access to this entity without proper authorization.[break]

[pre]
&lt;location path="elmah.axd"&gt;
  &lt;system.web&gt;
    &lt;authorization&gt;
      &lt;allow roles="Admin" /&gt;
      &lt;deny users="*" /&gt;
    &lt;/authorization&gt;
  &lt;/system.web&gt;
&lt;/location&gt;
[/pre]</Recommendation>
		<Reference database="ASP.NET session hijacking with Google and ELMAH" URL="http://www.troyhunt.com/2012/01/aspnet-session-hijacking-with-google.html"/>
	</TestDescription>
	<Connection scheme="${scheme}" host="${host}" port="${port}">
		<Step name="testfile">
			<Request>
				<MessageHeader>
					<Method>GET</Method>
					<URI>${scheme}://${host}:${port}${path}</URI>
					<Version>HTTP/1.0</Version>
				</MessageHeader>
				<MessageBody>
					<Separator></Separator>
					<Item encoding="text">${post}</Item></MessageBody>
			</Request>
			<Response>
				<SetVariable name="ResponseCode" type="string">
					<Description>The HTTP Response Code</Description>
					<Source source="status">^.*\s(\d\d\d)\s</Source>
				</SetVariable>
				<SetVariable name="FullBody" type="string">
					<Description>The HTTP Response Code</Description>
					<Source source="body">^(.*)$</Source>
				</SetVariable>
				<SetVariable name="redir302" type="string">
					<Description>Check to see if we are being redirected to another page</Description>
					<Source source="header">^Location: (.*)$</Source>
				</SetVariable>
				<SetVariable name="php_error_1" type="string">
					<Description>set the description here</Description>
					<Source source="body">(?i)(&lt;b&gt;(Warning|Fatal\serror|Parse\serror)&lt;/b&gt;:\s+.*?\(.*?\)\s*(\[&lt;a\shref=\'function\..*?'&gt;function\..*?&lt;/a&gt;])?:.*?\sin\s&lt;b&gt;.*?&lt;/b&gt;\son\sline\s&lt;b&gt;\d*?&lt;/b&gt;)</Source>
				</SetVariable>
			</Response>
			<TestCriteria type="success">
				<Compare variable="${ResponseCode}" test="eq">
					<Value>500</Value>
					<Compare variable="${FullBody}" test="cont">
						<Value>&lt;title&gt;Illegal characters in path.&lt;/title&gt;</Value>
					</Compare>
				</Compare>
			</TestCriteria>
			<TestCriteria type="failure">
				<Compare variable="${ResponseCode}" test="neq">
					<Value>500</Value>
				</Compare>
			</TestCriteria>
		</Step>
	</Connection>
	<Variable name="file" type="string">
		<Description>Site file to be tested</Description>
		<Item encoding="Text">test</Item></Variable>
	<Variable name="test" type="string">
		<Description>A list of tests to be performed</Description>
		<Item encoding="Text">test</Item></Variable>
	<Variable name="path" type="string">
		<Description>List of complete tests </Description>
		<Item encoding="Text">${file}${test}</Item></Variable>
</WebApplicationTest>
